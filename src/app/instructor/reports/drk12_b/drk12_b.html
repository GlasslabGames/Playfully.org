<div class="report-container--wide gl-margin--Txl gl-margin--Bxl">

    <div class="report-body gl-pad-Al" style="min-height: 623px">
        <div class="gl-drk12_b-l-container">
            <button class="fa fa-question-circle gl-drk12_b-helpicon" ng-click="openModal('info')" type="button"></button>
            <h1 class="gl-drk12_b-heading">Progress Report</h1>
            <p class="gl-drk12_b-text" ng-bind-html="reports.selected.description"></p>

            <tabset class="gl-drk12_b-tabs" justified="true">
                <tab heading="Whole Class" active="activeTab[0]" ng-click="selectTab(0)">
                    <div class="gl-drk12_b-l-containerclass">
                        <h3 class="gl-drk12_b-heading gl-drk12_b-heading-secondary">All Students' Current Mission</h3>
                        <div id="drk12_bChart" class="gl-drk12_b-chart" ng-init="doDrawCourseStatusChart()"></div> <!-- TODO: Refine this -->
                        <h3 class="gl-drk12_b-heading gl-drk12_b-heading-secondary">Current Class Skill Level</h3>
                        <p class="gl-drk12_b-text">
                            The four charts below show how well students performed using each skill during the most recent mission they played.
                        </p>
                        <hr/>
                        <table class="gl-drk12_b-piechartsilllevel">
                            <thead>
                                <tr>
                                    <th ng-repeat="header in tableStructuralData.headers" ng-if="$index > 1">
                                        {{header.label}}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td ng-repeat="header in tableStructuralData.headers" ng-if="$index > 1">
                                    <div ng-attr-id="{{'courseSkill_' + header.value}}"></div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <h4 class="gl-drk12_b-heading gl-drk12_b-heading-tertiary">Competency Levels</h4>
                        <ul class="gl-drk12_b-l-progressicons">
                            <li class="gl-drk12_b-progressicon" ng-class="progressType.class" ng-repeat="progressType in progressTypes">{{progressType.title}}</li>
                        </ul>
                    </div>
                </tab>
                <tab heading="Student Roster" active="activeTab[1]" ng-click="selectTab(1)">
                    <div class="gl-drk12_b-l-containerstudent">
                        <h3 class="gl-drk12_b-heading gl-drk12_b-heading-secondaryalt1">Select the skill(s) and click skill circles to view students' progress on individual skills across each mission.</h3>
                        <ul class="gl-drk12_b-competencyskills">
                            <li>
                                <label>
                                    <input type="radio" ng-model="tableStructuralData.columnFilter" ng-click="selectAllSkills()" value="all"/>
                                    All Skills
                                </label>
                            </li>
                            <li ng-repeat="header in tableStructuralData.headers" ng-if="$index > 1">
                                <label>
                                    <input type="radio" ng-model="tableStructuralData.columnFilter" ng-value="header.value" ng-checked="tableStructuralData.columnFilter == header.value" />
                                    {{header.title}}
                                </label>
                            </li>
                        </ul>
                        <ul class="gl-drk12_b-l-filterbuttons">
                            <li>
                                <button ng-disabled="tableStructuralData.columnFilter == 'all'" ng-click="tableStructuralData.studentFilter='all'"
                                        class="gl-drk12_b-filterbutton" ng-class="{'gl-drk12_b-filterbutton-is-active': tableStructuralData.studentFilter == 'all'}">
                                    All Students ({{reportData.students.length}})
                                </button>
                            </li>
                            <li ng-class="{'visibility-hidden': tableStructuralData.columnFilter == 'all'}" ng-repeat="(key, value) in progressTypes">
                                <button ng-click="tableStructuralData.studentFilter = value.class" class="gl-drk12_b-filterbutton" ng-class="['gl-drk12_b-filterbutton-{{value.class}}', {'gl-drk12_b-filterbutton-is-active' : tableStructuralData.studentFilter == value.class}]">
                                    {{value.title}} ({{reportData.courseSkills[tableStructuralData.columnFilter][value.class]}})
                                </button>
                            </li>
                        </ul>
                        <hr/>
                        <table class="table gl-reports-table gl-drk12_b-table" ng-class="{'gl-reports-table--ie': isIE}">
                            <thead>
                                <tr class="gl-drk12_b-table-x-header">
                                    <th rowspan="2">
                                        <button class="gl-drk12_b-tablesort" ng-click="sortSelected(tableStructuralData.headers[0].value)" type="button">
                                            {{tableStructuralData.headers[0].label}}
                                            <i ng-class="tableStructuralData.current===tableStructuralData.headers[0].value ? (tableStructuralData.reverseSort ? 'highlight fa fa-sort-up' : 'highlight fa fa-sort-down' ) : 'fa fa-sort-down'"></i>
                                        </button>
                                    </th>
                                    <th rowspan="2">
                                        <button class="gl-drk12_b-tablesort" ng-click="sortSelected(tableStructuralData.headers[1].value)" type="button">
                                            {{tableStructuralData.headers[1].label}}
                                            <i ng-class="tableStructuralData.current===tableStructuralData.headers[1].value ? (tableStructuralData.reverseSort ? 'highlight fa fa-sort-up' : 'highlight fa fa-sort-down' ) : 'fa fa-sort-down'"></i>
                                        </button>
                                    </th>
                                    <th colspan="{{numberOfColumnsChecked()}}">Progress for Most Recent Mission Skill Applied</th>
                                </tr>
                                <tr class="gl-drk12_b-table-x-headersecondary">
                                    <!-- first th is covered by previous row -->
                                    <!-- second th is covered by previous row -->
                                    <th ng-repeat="header in tableStructuralData.headers" ng-if="$index > 1 && (tableStructuralData.columnFilter == header.value || tableStructuralData.columnFilter == 'all')">
                                        <div class="gl-drk12_b-tooltip">
                                            <button class="gl-drk12_b-tablesort gl-drk12_b-tablesort-secondary" ng-class="{'gl-drk12_b-tablesort-single': tableStructuralData.columnFilter != 'all'}" ng-click="sortSelected(header.value)" type="button">
                                                {{header.label}}
                                                <i ng-class="tableStructuralData.current===header.value ? (tableStructuralData.reverseSort ? 'highlight fa fa-sort-up' : 'highlight fa fa-sort-down' ) : 'fa fa-sort-down'"></i>
                                            </button>
                                            <span class="gl-drk12_b-tooltip-x-tooltip">{{header.description}}</span>
                                        </div>
                                    </th>
                                </tr>
                                <tr>
                                    <th colspan="{{numberOfColumnsChecked() + 2}}" class="gl-drk12_b-table-x-tablefilterbar">
                                        <div class="gl-drk12_b-tablefilterbar gl-drk12_b-tablefilterbar-is-{{tableStructuralData.studentFilter}}">
                                            <label><input type="checkbox" ng-click="toggleAllStudentChecks($event)" ng-checked="isAllSelected()"/> Select All</label>
                                            <button ng-click="setCurrentStudents(selectedStudents); openModal('studentInfo');" ng-disabled="selectedStudents.length < 1" ng-class="{disabled: selectedStudents.length < 1}" class="gl-drk12_b-performancetrigger gl-clickable">
                                                View Selected Students' Performances Over Time
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="gl-reports-table-row" ng-repeat="student in courses.selected.users | orderBy:userSortFunction(tableStructuralData.current):tableStructuralData.reverseSort"
                                        ng-if="shouldShowStudentRow(student.results.currentProgress.skillLevel[tableStructuralData.columnFilter].level)">
                                    <td class="gl-drk12_b-table-x-name">
                                        <label for="{{student.id}}">
                                            <input type="checkbox" id="{{student.id}}" ng-checked="selectedStudents.indexOf(student) != -1" ng-click="toggleStudentCheck(student)"/>
                                            {{student.firstName}} {{student.lastName}}
                                        </label>
                                    </td>
                                    <td>{{student.results.currentProgress.mission}} / {{reportData.totalMissions}}</td>
                                    <td ng-repeat="header in tableStructuralData.headers" ng-if="$index > 1 && (tableStructuralData.columnFilter == header.value || tableStructuralData.columnFilter == 'all')">
                                        <div class="gl-drk12_b-progressicon gl-drk12_b-progressicon-table"
                                             ng-class="student.results.currentProgress.skillLevel[header.value].level"
                                             ng-click="navigateToDrilldown(student, student.results.missions[student.results.currentProgress.skillLevel[header.value].mission - 1], header.value)"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </tab>
            </tabset>
        </div>
    </div>
    <div class="gl-drk12_b-footerhelper" ng-init="collapse = false">
        <div class="gl-drk12_b-collapsebar" ng-click="collapse = !collapse">Report Helper <i class="fa" ng-class="{'fa-toggle-down': collapse, 'fa-toggle-up': !collapse}"></i></div>
        <div class="gl-drk12_b-collapsecontent" ng-class="{'expanded': !collapse}" collapse="collapse">
            <div ng-include="'instructor/reports/drk12_b/helperDrawer/helperDrawerWrapper.html'" style="height: 100%"></div>
        </div>
    </div>
    <script type="text/javascript">
        $('#drk12_b-header').on('scroll', function () {
            $('#drk12_b-body').scrollLeft($(this).scrollLeft());
        });

        $('#drk12_b-body').on('scroll', function () {
            $('#drk12_b-header').scrollLeft($(this).scrollLeft());
        });
    </script>
</div>
